#!/usr/bin/env node

'use strict';

var util = require('util'),
	commander = require('commander'),
	db = require('../server/lib/db'),
	moduleLoader = require('../server/lib/moduleLoader'),
	modules = moduleLoader.loadModules(),
	commands = moduleLoader.getCommands();

commander
	.version(require('../package.json').version);

commands.forEach(function(command) {
	if (!util.isFunction(command.callback)) {
		command.callback = modules[command.moduleName][command.callback];
	}

	// Setting up sub-command, arguments and options
	var currentCommand = commander
		.command(command.name)
		.description(command.description)
		.arguments(command.arguments.join(' '))
		.action(command.callback);

	command.options.forEach(function(option) {
		if (!util.isArray(option)) {
			option = [option, ''];
		}
	
		currentCommand.option(option[0], option[1]);
	});
});

commander
	.parse(process.argv);